import{renderToStream as C,createComponent as f,ssr as h,ssrHydrationKey as E,NoHydration as H,escape as c}from"solid-js/web";import{sharedConfig as p}from"solid-js";import{provideRequestEvent as A}from"solid-js/web/storage";import{getRequestURL as b,getRequestWebStream as T,getRequestIP as L,setResponseHeader as d,setResponseStatus as m,appendResponseHeader as F,getResponseHeader as $,removeResponseHeader as B,getCookie as I,setCookie as M,eventHandler as N,sendRedirect as P,setHeader as j}from"h3";import{c as k,m as O,S as W}from"./assets/StartServer-9710052a.js";function U(e){let t;const r=b(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...n,body:e.node.req.body}):new Request(r,{...n,get body(){return t||(t=T(e),t)}})}function _(e){return e.web??={request:U(e),url:b(e)},e.web.request}const S=Symbol("h3Event"),u=Symbol("fetchEvent"),J={get(e,t){return t===u?e:e[t]??e[S][t]}};function K(e){const t=_(e);return new Proxy({request:t,clientAddress:L(e),locals:{},[S]:e},J)}function z(e){if(!e[u]){const t=K(e);e[u]=t}return e[u]}function D(e){const t=I(e,"flash");if(!t)return;let r=JSON.parse(t);if(!r||!r.result)return[];const n=[...r.input.slice(0,-1),new Map(r.input[r.input.length-1])];return M(e,"flash","",{maxAge:0}),{url:r.url,result:r.error?new Error(r.result):r.result,input:n}}async function w(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,d(e,"Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],initialSubmission:D(e),routes:k(),components:{status:n=>(m(e,n.code,n.text),()=>m(e,200)),header:n=>(n.append?F(e,n.name,n.value):d(e,n.name,n.value),()=>{const a=$(e,n.name);if(a&&typeof a=="string"){const o=a.split(", "),s=o.indexOf(n.value);s!==-1&&o.splice(s,1),o.length?d(e,n.name,o.join(", ")):B(e,n.name)}})},$islands:new Set})}function G(e,t={}){return N({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:r=>{const n=z(r);return A(n,async()=>{const a=O(new URL(n.request.url).pathname,n.request.method);if(a){const l=(await a.handler.import())[n.request.method];return n.params=a.params,p.context={event:n},await l(n)}const o=await w(n);let s={...t};if(s.onCompleteAll){const i=s.onCompleteAll;s.onCompleteAll=l=>{R(o)(l),i(l)}}else s.onCompleteAll=R(o);if(s.onCompleteShell){const i=s.onCompleteShell;s.onCompleteShell=l=>{g(o,r)(),i(l)}}else s.onCompleteShell=g(o,r);const y=C(()=>(p.context.event=o,e(o)),s);if(o.response&&o.response.headers.get("Location"))return P(n,o.response.headers.get("Location"));const{writable:q,readable:v}=new TransformStream;return y.pipeTo(q),v})}})}function g(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(m(t,302),j(t,"Location",e.response.headers.get("Location")))}}function R(e){return({write:t})=>{const r=e.response&&e.response.headers.get("Location");r&&t(`<script>window.location="${r}"<\/script>`)}}function Q(e,t={}){return G(e,{...t,createPageEvent:w})}var V=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>热烈的杯</title><link rel="icon" href="/favicon.ico">',"</head>"],X=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const ne=Q(()=>f(W,{document:({assets:e,children:t,scripts:r})=>h(X,E(),f(H,{get children(){return h(V,c(e))}}),c(t),c(r))}));export{ne as default};
