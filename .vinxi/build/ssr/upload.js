import{r as f}from"./assets/index-2592bed9.js";import"axios";const o=["https://telegra.ph/upload","https://api.github.com/repos"];function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){var a=Math.random()*16|0,t=s=="x"?a:a&3|8;return t.toString(16)}).replace(/[-]/g,"")}async function g(s){let a="";const t=new Uint8Array(s),e=t.byteLength;for(let n=0;n<e;n+=1)a+=String.fromCharCode(t[n]);return btoa(a)}async function y(s){const a=await s.request.formData(),t=a.get("file"),e=a.get("index"),n=new FormData;if(e==="0")n.append("file",t),n.append("wechatapp_id","441150");else if(e==="1"){var x=a.get("repo"),u=a.get("fileName"),c=new Date(Date.now()+8*3600*1e3).toISOString().replace("Z","").replace(/[-T.]/g,"").substr(0,8),p="."+u.replace(/\//g,"").split(".").at(-1),l=d();o[e]=`https://api.github.com/repos/${x}/contents/${c}/${l}${p}`}try{let i;if(e==="1"){const r=await t.arrayBuffer(),m=await g(r);i=await f({url:o[e],method:"PUT",data:{message:"init",content:m},headers:{Authorization:process.env.GITHUB_TOKEN}})}else i=await f({url:o[e],method:"POST",data:n});if(e==1?i.status==201:i.status==200){let r;return e==0?r="https://rldmtest.pages.dev"+i.data[0].src:e==1&&(r=`https://www.jsdelivr.ren/gh/${x}@master/${c}/${l}${p}`),{URL:r,BBCode:`[img]${r}[/img]`,HTML:`<img src="${r}" alt="${t.name}" title="${t.name}" />`,Markdown:`![${t.name}](${r})`,"Markdown with link":`[![${t.name}](${r})](${r})`}}}catch(i){return new Response(JSON.stringify(i),{status:500,"Content-Type":"text/html; charset=utf-8"})}}export{y as POST};
